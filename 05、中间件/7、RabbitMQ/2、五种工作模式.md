[TOC]

# äº”ç§å·¥ä½œæ¨¡å¼

> æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼
>
> - ç®€å•æ¨¡å¼
> - äº‰æŠ¢æ¨¡å¼
> - å‘å¸ƒè®¢é˜…æ¨¡å¼
> - è·¯ç”±æ¨¡å¼
> - ä¸»é¢˜æ¨¡å¼



## ç®€å•æ¨¡å¼

> å¼ºè°ƒçš„ä¸æ˜¯ç”Ÿäº§ç«¯å‘é€æ¶ˆæ¯çš„é€»è¾‘ï¼Œå¼ºè°ƒçš„æ˜¯æ¶ˆè´¹ç«¯ç›‘å¬çš„é€»è¾‘

![](https://gitee.com/sxhDrk/images/raw/master/imgs/äº‰æŠ¢æ¨¡å¼.png)

- ç”Ÿäº§ç«¯ï¼šå°è£…æ•´ç†æ¶ˆæ¯ï¼Œè¿æ¥rabbitmqï¼Œå°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœº
- äº¤æ¢æœºï¼šæ¥æ”¶æ‰€æœ‰å½“å‰è¿æ¥çš„ç”Ÿäº§ç«¯çš„æ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯çš„å‚æ•°ï¼Œå†³å®šåç«¯è¿æ¥å“ªä¸ªé˜Ÿåˆ—å‘é€è¯¥æ¶ˆæ¯
- é˜Ÿåˆ—ï¼šç”Ÿæˆæ—¶å°±ä¼šç»‘å®šäº¤æ¢æœºï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯
- ==æ¶ˆè´¹ç«¯==ï¼šç®€å•æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªé˜Ÿåˆ—åªè¢«ä¸€ä¸ªæ¶ˆè´¹ç«¯ç›‘å¬ï¼Œå½“é˜Ÿåˆ—æœ‰æ¶ˆæ¯æ—¶ï¼Œæ¶ˆè´¹è€…å°±ä¼šæ‹¿èµ°æ¶ˆæ¯è¿›è¡Œå¤„ç†



> åº”ç”¨åœºæ™¯ï¼šé‚®ä»¶ã€çŸ­ä¿¡ã€èŠå¤©



## äº‰æŠ¢æ¨¡å¼ï¼ˆä¹Ÿå«å·¥ä½œæ¨¡å¼ï¼‰

> å¼ºè°ƒçš„æ˜¯å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶ç›‘å¬ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½¢æˆæ¶ˆæ¯çš„äº‰æŠ¢

![](https://gitee.com/sxhDrk/images/raw/master/imgs/å‘å¸ƒè®¢é˜…æ¨¡å¼.png)

- ç”Ÿæˆç«¯ï¼šå‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœº
- äº¤æ¢æœºï¼šè½¬å‘æ¶ˆæ¯åˆ°æŒ‡å®šé˜Ÿåˆ—
- é˜Ÿåˆ—ï¼šå­˜å‚¨æ¶ˆæ¯
- æ¶ˆè´¹ç«¯ï¼šå¤šä¸ªæ¶ˆè´¹ç«¯åŒæ—¶è¿æ¥åŒä¸€ä¸ªé˜Ÿåˆ—å®ç°æ¶ˆæ¯ç›‘å¬ï¼Œå½¢æˆäº‰æŠ¢çš„ç»“æ„ï¼ˆå“ªä¸ªæ¶ˆè´¹ç«¯ç©ºé—²ç‡é«˜ï¼Œçº¿ç¨‹èµ„æºå¤šï¼Œå°±æ›´æœ‰æœºä¼šæŠ¢åˆ°æ¶ˆæ¯ï¼‰



> åº”ç”¨åœºæ™¯ï¼šæŠ¢çº¢åŒ…ï¼Œèµ„æºåˆ†é…ç³»ç»Ÿ

![](https://gitee.com/sxhDrk/images/raw/master/imgs/ç®€å•æ¨¡å¼.png)



## å‘å¸ƒè®¢é˜…æ¨¡å¼

> å‘é€ä¸€æ¡æ¶ˆæ¯ï¼ŒåŒæ­¥åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­
>
> å¼ºè°ƒç”Ÿäº§ç«¯ã€äº¤æ¢æœºå‘é€æ¶ˆæ¯çš„é€»è¾‘

![](https://gitee.com/sxhDrk/images/raw/master/imgs/äº‰æŠ¢æ¨¡å¼-æŠ¢çº¢åŒ…å›¾è§£.png)

- ç”Ÿäº§ç«¯ï¼šå°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœº
- äº¤æ¢æœºï¼šå°†æ¶ˆæ¯åŒæ­¥å¤åˆ¶å‘é€åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ï¼Œäº¤æ¢æœºç±»å‹ï¼š`fanout`
- é˜Ÿåˆ—ï¼šå­˜å‚¨æ¶ˆæ¯
- æ¶ˆè´¹ç«¯ï¼šå¯èƒ½æ˜¯ç®€å•æ¨¡å¼ï¼Œä¹Ÿå¯èƒ½æ˜¯äº‰æŠ¢æ¨¡å¼



> åº”ç”¨åœºæ™¯ï¼šé‚®ä»¶ç¾¤å‘ã€å¹¿å‘Šçš„å‘é€





## è·¯ç”±æ¨¡å¼

> è·¯ç”±æ¨¡å¼æ˜¯rabbitmq==æ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼==ï¼Œå¯ä»¥æ ¹æ®ç”Ÿäº§ç«¯çš„æ¶ˆæ¯å‚æ•°å†³å®šå½“å‰æ¶ˆæ¯è¯¥å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œä¸å‘ç»™å“ªäº›é˜Ÿåˆ—
>
> è·¯ç”±ï¼šä»èµ·ç‚¹åˆ°ç›®çš„åœ°çš„è·¯çº¿ï¼Œå°±æ˜¯è·¯ç”±è§„åˆ™çš„å®šä¹‰

![](https://gitee.com/sxhDrk/images/raw/master/imgs/è·¯ç”±æ¨¡å¼.png)

- ç”Ÿäº§ç«¯ï¼šå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­æºå¸¦å…·ä½“çš„è·¯ç”±keyï¼š`routingKey`
- äº¤æ¢æœºï¼šæ¥æ”¶åˆ°æ¶ˆæ¯å
  - ä¼šåœ¨ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ä¸­åŒ¹é…è·¯ç”±keyï¼ŒåŒ¹é…åˆ°å°±å°†æ¶ˆæ¯å‘é€ç»™è¿™ä¸ªé˜Ÿåˆ—
  - åŒ¹é…ä¸åˆ°ï¼Œæ¶ˆæ¯å°±åœ¨äº¤æ¢æœºä¸­ç›´æ¥åˆ é™¤
- é˜Ÿåˆ—ï¼šå­˜å‚¨æ¶ˆæ¯
- æ¶ˆè´¹ç«¯ï¼šç®€å•æ¨¡å¼æˆ–è€…äº‰æŠ¢æ¨¡å¼



![](https://gitee.com/sxhDrk/images/raw/master/imgs/ä¸»é¢˜æ¨¡å¼åº”ç”¨åœºæ™¯.png)

> ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„è·¯ç”±é”®ä¸ºerroræ—¶ï¼Œä¸¤ä¸ªé˜Ÿåˆ—å‡å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼›å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„è·¯ç”±é”®ä¸ºinfoæˆ–warningæ—¶ï¼Œåªæœ‰ç¬¬äºŒä¸ªé˜Ÿåˆ—å¯æ”¶åˆ°æ¶ˆæ¯ã€‚



> åº”ç”¨åœºæ™¯ï¼šæŒ‡å®šé‚®ç®±å‘é€é‚®ä»¶ã€ç³»ç»Ÿerroræ¶ˆæ¯è·¯ç”±





## ä¸»é¢˜æ¨¡å¼

> å°†è·¯ç”±keyè¿›è¡Œå¤šçº§åˆ’åˆ†ï¼Œå®ç°å¤šçº§ä¼ é€’çš„ä¸€ç§ä½¿ç”¨æ–¹å¼
>
> äº¤æ¢æœºç±»å‹ï¼š`topic`

![](https://gitee.com/sxhDrk/images/raw/master/imgs/ä¸»é¢˜æ¨¡å¼.png)



å’Œè·¯ç”±æ¨¡å¼ä½¿ç”¨é€»è¾‘ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹æ¶ˆæ¯ä¸­çš„è·¯ç”±keyä¸ç»‘å®šçš„é˜Ÿåˆ—keyè¿›è¡ŒåŒ¹é…ï¼ŒåŒºåˆ«åœ¨äºä¸»é¢˜æ¨¡å¼çš„é˜Ÿåˆ—ä½¿ç”¨çš„è·¯ç”±keyå¯ä»¥ä¸æ˜¯å…·ä½“çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªèŒƒå›´çš„åŒ¹é…

| ç¬¦å· | è§£é‡Š           |
| ---- | -------------- |
| *    | åŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸² |
| #    | åŒ¹é…å¤šçº§å­—ç¬¦ä¸² |



> ä¾‹å­ï¼šæ¶ˆæ¯çš„ç›®çš„åœ°ï¼šä¸­å›½.åŒ—äº¬.æœé˜³

| é˜Ÿåˆ—                | èƒ½å¦æ¥æ”¶æ¶ˆæ¯                                |
| ------------------- | ------------------------------------------- |
| queue1(`ä¸­å›½.#`)    | true                                        |
| queue2(`*.*.æœé˜³`ï¼‰ | true                                        |
| queue3(`ä¸­å›½.*`)    | false<br />ä¸­å›½.ä¸Šæµ·ï¼Œä¸­å›½.æ–°ç–†    å¯ä»¥æ¥æ”¶ |



![](https://gitee.com/sxhDrk/images/raw/master/imgs/ä¸»é¢˜æ¨¡å¼è¯¦è§£.png)

> ä»¥ä¸Šå›¾ä¸ºä¾‹
>
> Q1é˜Ÿåˆ—çš„è·¯ç”±é”®ä¸º`*.orange.*`,Q2é˜Ÿåˆ—çš„è·¯ç”±é”®ä¸º`*.*.rabbit`å’Œ`lazy.#`
>
> - å½“æ¶ˆæ¯çš„è·¯ç”±é”®ä¸º`quick.orange.rabbit`æ—¶ï¼Œä¸¤ä¸ªé˜Ÿåˆ—å‡èƒ½æ”¶åˆ°
> - å½“æ¶ˆæ¯çš„è·¯ç”±é”®ä¸º`lazy.orange.male.rabbit`æ—¶ï¼Œåªæœ‰Q2é˜Ÿåˆ—èƒ½æ”¶åˆ°ã€‚



> åº”ç”¨åœºæ™¯ï¼šå¤šçº§æ¶ˆæ¯ä¼ é€’çš„åŒç±»åŒ¹é…

![](https://gitee.com/sxhDrk/images/raw/master/imgs/æ–°ç”Ÿæˆçš„é˜Ÿåˆ—é»˜è®¤ç»‘å®šåˆ°AMQP defaultäº¤æ¢æœºä¸Š.png)







# Javaä»£ç å®ç°äº”ç§æ¨¡å¼

> ä½¿ç”¨springbootæ•´åˆä¾èµ–ï¼š`spring-boot-starter-amqp`

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```



## åˆå§‹åŒ–è¿æ¥å¯¹è±¡

```java
//å®ç°ç”Ÿäº§ç«¯æˆ–è€…æ¶ˆè´¹ç«¯ä¹‹å‰ï¼Œåˆ›å»ºè¿æ¥å¯¹è±¡
private Channel channel;
//ç»™channelèµ‹å€¼
@Before
public void initChannel() throws IOException, TimeoutException {
    //è·å–è¿æ¥å·¥å‚å¯¹è±¡ï¼Œèµ‹å€¼è¿æ¥ä¿¡æ¯ ip port user pw vh
    ConnectionFactory factory=new ConnectionFactory();
    factory.setHost("10.9.104.184");
    factory.setPort(5672);
    //factory.setUsername("guest");//é»˜è®¤ç”¨æˆ·åå°±æ˜¯guest
    //factory.setPassword("guest");//é»˜è®¤å¯†ç å°±æ˜¯guest
    //factory.setVirtualHost("/");//é»˜è®¤å€¼å°±æ˜¯ï¼š/

    Connection connection = factory.newConnection();
    channel=connection.createChannel();
}
```



## ç®€å•æ¨¡å¼

> å¯ä»¥ä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼ˆAMQP defaultï¼‰ï¼šè·¯ç”±æ¨¡å¼
>
> ä»£ç ä¸­ï¼Œé»˜è®¤äº¤æ¢æœºçš„åç§°ä¸ºï¼š`""`
>
> è¿™ä¸ªäº¤æ¢æœºçš„å­˜åœ¨ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ä»»ä½•ä¸€ä¸ªé˜Ÿåˆ—åœ¨ç”Ÿæˆæ—¶ï¼Œæ²¡æœ‰ç»‘å®šå…¶ä»–äº¤æ¢æœºï¼Œä¼šé»˜è®¤ç»‘å®šåˆ°è¿™ä¸ªAMPQ defaultäº¤æ¢æœºä¸Šï¼Œé»˜è®¤çš„è·¯ç”±keyå°±æ˜¯é˜Ÿåˆ—çš„åç§°
>
> ![](https://gitee.com/sxhDrk/images/raw/master/imgs/è·¯ç”±æ¨¡å¼å›¾è§£.png)



### ç”Ÿäº§è€…

> å°†ä¸€ä¸ªæ¶ˆæ¯æ–‡æœ¬msgå‘é€åˆ°é»˜è®¤çš„AMQP defaultäº¤æ¢æœºä¸Šï¼Œå¹¶æºå¸¦ä¸€ä¸ªè·¯ç”±keyï¼ˆé˜Ÿåˆ—çš„åç§°ï¼‰

```java
//ç”Ÿäº§ç«¯ä»£ç ï¼šå°†æ¶ˆæ¯å‘é€åˆ°é»˜è®¤çš„äº¤æ¢æœºï¼šAMQP defaultï¼Œæºå¸¦ä¸€ä¸ªè·¯ç”±keyï¼ˆå­˜åœ¨çš„é˜Ÿåˆ—åç§°ï¼‰
@Test
public void send() throws IOException {
    String msg = "å¤šæ—¥ä¸è§ï¼Œç”šæ˜¯æƒ³å¿µï¼Œä»Šå¤œä¸‰æ›´ï¼Œåå±±è§é¢"
    //å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—,é˜Ÿåˆ—ä¸å­˜åœ¨æ—¶åˆ›å»º
    channel.queueDeclare("å°çº¢",false,false,false,null);
    //å‘é€
    channel.basicPublish("", "å°çº¢", null, msg.getBytes());
}
```

> å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼š

 `channel.queueDeclare("å°çº¢",false,false,false,null);`

| å‚æ•°ä½ç½®                                 | æ¥æ”¶ç±»å‹ | ä½œç”¨                                                         |
| ---------------------------------------- | -------- | ------------------------------------------------------------ |
| ç¬¬ä¸€ä¸ªå‚æ•°queue                          | String   | ==é˜Ÿåˆ—åç§°==                                                 |
| ç¬¬äºŒä¸ªå‚æ•°durable(æŒä¹…çš„)[ËˆdjÊŠÉ™rÉ™bl]     | Boolean  | ==é˜Ÿåˆ—æ˜¯å¦æ”¯æŒæŒä¹…åŒ–==ï¼ˆwebæ§åˆ¶å°ä¸­æ˜¾ç¤ºçš„`D`è¡¨ç¤ºé˜Ÿåˆ—æŒä¹…åŒ–ï¼‰<br />ä¸æŒä¹…åŒ–ï¼Œåœ¨rabbitmqé‡å¯åï¼Œé˜Ÿåˆ—å°±ä¼šæ¶ˆå¤± |
| ç¬¬ä¸‰ä¸ªå‚æ•°exclusive(ä¸“å±çš„)[ÉªkËˆskluËsÉªv] | Boolean  | ==é˜Ÿåˆ—æ˜¯å¦ä¸“å±==ï¼ˆä¸“å±äºå½“å‰Connectionï¼‰<br />trueï¼šæ“ä½œè¿æ¥è¿™ä¸ªé˜Ÿåˆ—ï¼Œåªæœ‰å½“å‰è¿™ä¸ªConnectionæ‰èƒ½è¿› |
| ç¬¬å››ä¸ªå‚æ•°autoDelete                     | Boolean  | ==æ˜¯å¦è‡ªåŠ¨åˆ é™¤==<br />trueï¼šå½“æ‰€æœ‰è®¢é˜…è¯¥é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½è§£é™¤äº†è®¢é˜…ï¼Œè¯¥é˜Ÿåˆ—ä¼šè¢«åˆ é™¤ |
| ç¬¬äº”ä¸ªå‚æ•°args                           | Map      | ==åˆ›å»ºé˜Ÿåˆ—çš„å„ç§å±æ€§==ï¼Œä¾‹å¦‚æ¶ˆæ¯å­˜æ´»çš„æœ€é•¿æ—¶é—´ã€é˜Ÿåˆ—ä¿å­˜çš„æœ€å¤šæ¶ˆæ¯ä¸ªæ•° |

![](https://gitee.com/sxhDrk/images/raw/master/imgs/javaä»£ç åˆ›å»ºé˜Ÿåˆ—å›¾è§£.png)



> å‘é€æ¶ˆæ¯ï¼š

`channel.basicPublish("", "å°çº¢", null, msg.getBytes());`

| å‚æ•°ä½ç½®             | æ¥æ”¶ç±»å‹        | ä½œç”¨                                         |
| -------------------- | --------------- | -------------------------------------------- |
| ç¬¬ä¸€ä¸ªå‚æ•°exchange   | String          | ==äº¤æ¢æœºåç§°==                               |
| ç¬¬äºŒä¸ªå‚æ•°routingKey | String          | ==è·¯ç”±Key==ï¼Œé»˜è®¤äº¤æ¢æœºä¸­è·¯ç”±Keyå°±æ˜¯é˜Ÿåˆ—åç§° |
| ç¬¬ä¸‰ä¸ªå‚æ•°props      | BasicProperties | ==æ¶ˆæ¯çš„å±æ€§==                               |
| ç¬¬å››ä¸ªå‚æ•°body       | Byte[]          | ==æ¶ˆæ¯ä½“çš„äºŒè¿›åˆ¶æ•°æ®==                       |



### æ¶ˆè´¹è€…

> Consumerï¼šæ¶ˆè´¹è€… [kÉ™nËˆsjuËmÉ™(r)] 

```java
//æ¶ˆè´¹ç«¯ä»£ç ï¼š
@Test
public void consumer() throws IOException, InterruptedException {
    //åˆ›å»ºæ¶ˆè´¹å¯¹è±¡
    //consumerç»‘å®šchannelåï¼Œå°±å…·å¤‡äº†ç»‘å®šqueueçš„èƒ½åŠ›
    QueueingConsumer consumer = new QueueingConsumer(channel);

    //ç»‘å®šæ¶ˆè´¹å¯¹è±¡å’Œé˜Ÿåˆ—ï¼šå°çº¢ï¼Œå®ç°ä¸€å¯¹ä¸€ç›‘å¬
    channel.basicConsume("å°çº¢", true, consumer);

    //ç›‘å¬è·å–æ¶ˆæ¯ä¿¡æ¯
    QueueingConsumer.Delivery delivery = consumer.nextDelivery();//ä»ç›‘å¬çš„é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªæ¶ˆæ¯

    //deliveryæ¥æ”¶çš„æ¶ˆæ¯ä½“bodyä»¥å¤–ï¼Œè¿˜æœ‰headerã€property
    System.out.println(new String(delivery.getBody()));

}
```

> ç»‘å®šæ¶ˆè´¹å¯¹è±¡

`channel.basicConsume("å°çº¢", true, consumer);`

| å‚æ•°ä½ç½®           | æ¥æ”¶ç±»å‹ | ä½œç”¨                                                         |
| ------------------ | -------- | ------------------------------------------------------------ |
| ç¬¬ä¸€ä¸ªå‚æ•°queue    | String   | ==é˜Ÿåˆ—åç§°==                                                 |
| ç¬¬äºŒä¸ªå‚æ•°autoAck  | Boolean  | ==æ˜¯å¦è‡ªåŠ¨å›æ‰§==<br />å›æ‰§ï¼šå‘Šè¯‰rabbitmqæ˜¯å¦æ¶ˆè´¹æˆåŠŸ<br />æˆåŠŸè¿”å›trueï¼šrabbitmqä¼šå°†è¯¥æ¶ˆæ¯åˆ é™¤<br />å¤±è´¥è¿”å›falseï¼šè¯¥æ¶ˆå¤±ç»§ç»­ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ |
| ç¬¬ä¸‰ä¸ªå‚æ•°callback | Consumer | ==ç»‘å®šçš„æ¶ˆè´¹è€…==                                             |



## äº‰æŠ¢æ¨¡å¼

> å¤šä¸ªæ¶ˆè´¹è€…ç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“æ¶ˆè´¹è€…ç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶ï¼Œåœ¨é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªæ•°æ®

### ç”Ÿäº§è€…

```java
@Test
public void send() throws IOException {
    String msg="å°çº¢æƒ…ä¹¦ï¼šæˆ‘å°±å–œæ¬¢ä½ æ¯æ¬¡ç»™æˆ‘é€çš„å¤§ç™½è–¯";
    channel.queueDeclare("å°çº¢",false,false,false,null);
    for(int i=0;i<100;i++) {
        channel.basicPublish("", "å°çº¢", null, msg.getBytes());
    }
}
```



### æ¶ˆè´¹è€…

```java
//æ¶ˆè´¹ç«¯é€»è¾‘
@Test
public void consumer01() throws Exception {

    //åˆ›å»ºå‡ºæ¥æ¶ˆè´¹ç«¯å¯¹è±¡
    QueueingConsumer consumer=new QueueingConsumer(channel);
    channel.basicConsume("å°çº¢",true,consumer);

    while(true){
        QueueingConsumer.Delivery delivery = consumer.nextDelivery();//ä»ç›‘å¬çš„é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ª

        //å­˜åœ¨çš„æ¶ˆæ¯
        //deliveryæ¥æ”¶çš„é™¤äº†æ¶ˆæ¯ä½“bodyä»¥å¤–è¿˜æœ‰header properties
        System.out.println("é˜¿å¼ºæ‹¿åˆ°æ¶ˆæ¯ï¼š"+new String(delivery.getBody()));//bodyæ˜¯äºŒè¿›åˆ¶æ•°ç»„
    }
}

//æ¶ˆè´¹ç«¯é€»è¾‘

@Test
public void consumer02() throws Exception {
    //åˆ›å»ºå‡ºæ¥æ¶ˆè´¹ç«¯å¯¹è±¡
    QueueingConsumer consumer=new QueueingConsumer(channel);
    channel.basicConsume("å°çº¢",true,consumer);
    
    while(true){
        QueueingConsumer.Delivery delivery = consumer.nextDelivery();//ä»ç›‘å¬çš„é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ª

        //å­˜åœ¨çš„æ¶ˆæ¯
        //deliveryæ¥æ”¶çš„é™¤äº†æ¶ˆæ¯ä½“bodyä»¥å¤–è¿˜æœ‰header properties
        System.out.println("é˜¿æ˜æ‹¿åˆ°æ¶ˆæ¯ï¼š"+new String(delivery.getBody()));//bodyæ˜¯äºŒè¿›åˆ¶æ•°ç»„
    }
}
```





## å‘å¸ƒè®¢é˜…æ¨¡å¼

> åŒæ­¥å‘é€åˆ°å¤šä¸ªé˜Ÿåˆ—æ‰§è¡Œç¾¤å‘ï¼Œä½¿ç”¨å·²æœ‰çš„äº¤æ¢æœº`amp.fanout`ä¹Ÿå¯ä»¥å®ç°å‘å¸ƒè®¢é˜…
>
> ä¹Ÿå¯ä»¥è‡ªå®šä¹‰äº¤æ¢æœºï¼Œè‡ªå®šä¹‰ç»‘å®šå…³ç³»ï¼Œå®ç°æ¶ˆæ¯çš„å‘é€

### ç”Ÿäº§è€…

```java
//äº¤æ¢æœºç±»å‹
private static final String type = "fanout";
//äº¤æ¢æœºåç§°
private static final String exName = type + "Ex";
//é˜Ÿåˆ—åç§°
private static final String q1 = "queue01" + type;
private static final String q2 = "queue02" + type;

@Test
public void send() throws IOException {
    //å‡†æ¶ˆæ¯
    String msg = "hello " + type;

    //å£°æ˜äº¤æ¢æœº exName type
    channel.exchangeDeclare(exName, type);

    //å£°æ˜é˜Ÿåˆ—ï¼Œå¤šä¸ªé˜Ÿåˆ—ï¼ŒåŒæ—¶ç»‘å®šä¸€ä¸ªfanoutäº¤æ¢æœº
    channel.queueDeclare(q1,false,false,false,null);
    channel.queueDeclare(q2,false,false,false,null);

    //ç»‘å®š
    channel.queueBind(q1,exName,"keke");
    channel.queueBind(q2,exName,"keke");

    //å‘é€æ¶ˆæ¯
    channel.basicPublish(exName,"keke",null,msg.getBytes());
}
```



### æ¶ˆè´¹è€…

> å¯ä»¥æ˜¯ç®€å•æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯äº‰æŠ¢æ¨¡å¼



## è·¯ç”±æ¨¡å¼

> é˜Ÿåˆ—æ˜¯è¯¦ç»†çš„è·¯ç”±ç»‘å®šï¼Œæ¶ˆæ¯æºå¸¦è·¯ç”±keyï¼Œäº¤æ¢æœºåŒ¹é…é˜Ÿåˆ—çš„è·¯ç”±è¿›è¡Œæ¶ˆæ¯çš„å‘é€

### ç”Ÿäº§è€…

```java
//äº¤æ¢æœºç±»å‹
private static final String type = "direct";
//äº¤æ¢æœºåç§°
private static final String exName = type + "Ex";
//é˜Ÿåˆ—åç§°
private static final String q1 = "queue01" + type;
private static final String q2 = "queue02" + type;

@Test
public void send() throws IOException {

    //å‡†æ¶ˆæ¯
    String msg = "hello " + type;

    //å£°æ˜äº¤æ¢æœº exName type
    channel.exchangeDeclare(exName, type);

    //å£°æ˜é˜Ÿåˆ—ï¼Œå¤šä¸ªé˜Ÿåˆ—ï¼ŒåŒæ—¶ç»‘å®šä¸€ä¸ªfanoutäº¤æ¢æœº
    channel.queueDeclare(q1,false,false,false,null);
    channel.queueDeclare(q2,false,false,false,null);

    //ç»‘å®š
    channel.queueBind(q1,exName,"åŒ—äº¬");
    channel.queueBind(q1,exName,"åŒ—æˆ´æ²³");
    channel.queueBind(q1,exName,"å“ˆå°”æ»¨");
    channel.queueBind(q2,exName,"ä¸Šæµ·");

    //å‘é€æ¶ˆæ¯
    channel.basicPublish(exName,"å“ˆå°”æ»¨",null,msg.getBytes());
}
```



## ä¸»é¢˜æ¨¡å¼

> Topicä¸»é¢˜æ¨¡å¼å’Œroutingè·¯ç”±æ¨¡å¼ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™é‡Œçš„äº¤æ¢æœºä½¿ç”¨çš„æ˜¯topicç±»å‹ï¼Œtopicç±»å‹çš„äº¤æ¢æœºå’Œdirectçš„ä¸åŒå°±åœ¨äºtopicå¯ä»¥åŒ¹é…é€šé…ç¬¦ã€‚
>
> - `*`ä»£è¡¨åŒ¹é…ä¸€ä¸ªå…ƒç´ 
> - `#`ä»£è¡¨åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ 

### ç”Ÿäº§è€…

```java
//å‡†å¤‡å‡ ä¸ªé™æ€å¸¸é‡
private static final String type="topic";//äº¤æ¢æœºç±»å‹
private static final String exName=type+"Ex";//äº¤æ¢æœºåç§°
private static final String q1="queue01"+type;
private static final String q2="queue02"+type;

@Test
public void send() throws IOException {

    // 1.å‡†å¤‡æ¶ˆæ¯
    String msg = "hello " + type;

    // 2.å£°æ˜äº¤æ¢æœº exName type
    channel.exchangeDeclare(exName, type);

    // 3.åˆ›å»ºé˜Ÿåˆ—
    channel.queueDeclare(q1,false,false,false,null);
    channel.queueDeclare(q2,false,false,false,null);

    //äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„ç»‘å®š
    channel.queueBind(q1,exName,"ä¸­å›½.#");
    channel.queueBind(q2,exName,"ä¸­å›½.ä¸Šæµ·.*");

    //å‘é€æ¶ˆæ¯
    channel.basicPublish(exName,"ä¸­å›½.åŒ—äº¬.æœé˜³",null,msg.getBytes());
}
```

