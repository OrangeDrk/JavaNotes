[TOC]



# å›é¡¾ä¹‹å‰çš„ç»„ä»¶

## eurekaæ²»ç†ç»„ä»¶

![](https://note.youdao.com/yws/api/personal/file/DA3EE967740C45798609B3E24FF9E9BF?method=download&shareKey=03c886263960529478d6be1ab9faefc4)

## ribbonè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯

![](https://note.youdao.com/yws/api/personal/file/907C17FE121E4F93952168C6528A6A8B?method=download&shareKey=f232532b9d0dab5371d8e462b7a65b91)

## zuulç½‘å…³

![](https://note.youdao.com/yws/api/personal/file/F0EEC4C9FDEF4D5D91CCF806EDE03A4C?method=download&shareKey=0a859eb078d7e2dcb56ace1b222acf4e)



# config

> é…ç½®æ–‡ä»¶çš„configç»„ä»¶ï¼šspring cloud config

å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œå¾®æœåŠ¡æä¾›è€…æ­å»ºç¯å¢ƒæ—¶ï¼Œæ€»æ˜¯ä¼šå‡ºç°å¤§é‡propertiesé‡å¤çš„é…ç½®ï¼Œspringcloudæä¾›äº†ä¸€ä¸ªé«˜å¯ç”¨è®¿é—®çš„é…ç½®ä¸­å¿ƒï¼šconfigã€‚==å®ç°å¯¹é…ç½®æ–‡ä»¶å†…å®¹çš„ç±»å‹ï¼Œæ ‡ç­¾åˆ†ç±»ç®¡ç†==

![](https://note.youdao.com/yws/api/personal/file/7C27941CA9904B6C8E8C12B370BCA131?method=download&shareKey=33a681d7aa055a77d99cbb87fd1b723a)

> æ ¹æ®æŠ€æœ¯çš„é…ç½®å†…å®¹ã€åˆ’åˆ†åŠŸèƒ½/æŠ€æœ¯ã€ç‹¬ç«‹é…ç½®æ–‡ä»¶ï¼Œå…±äº«ä½¿ç”¨



## è§’è‰²

> 2ä¸ªè§’è‰²ï¼Œå’Œeurekaç±»ä¼¼

- serverç«¯ï¼šä»å…±äº«å­˜å‚¨çš„èµ„æºæœåŠ¡å™¨ï¼ˆgithubã€giteeï¼‰ï¼Œgitèµ„æºç‰ˆæœ¬æ§åˆ¶æœåŠ¡å™¨è·å–èµ„æºï¼ˆå­˜æœ‰å„ç§ä¸åŒçš„å…¬ç”¨é…ç½®æ–‡ä»¶ï¼‰
- clientç«¯ï¼ˆéœ€è¦è·å–é…ç½®çš„æœåŠ¡æä¾›è€…ï¼‰ï¼šä»serverä¸­æŒ‰ç…§æ¥å£è¦æ±‚ï¼Œè®¿é—®è·å–æ‰€æœ‰çš„yml/propertiesæ•°æ®

> å¦‚æœæƒ³å®ç°configé…ç½®ä¸­å¿ƒçš„é«˜å¯ç”¨ï¼Œéœ€è¦å°†é…ç½®ä¸­å¿ƒæ³¨å†Œåœ¨eurekaï¼Œclienté€šè¿‡æœåŠ¡åç§°è®¿é—®serverç«¯



## é…ç½®ä¸­å¿ƒconfig server

> é…ç½®ä¸­å¿ƒè¯»å–ç½‘ç»œå…±äº«æ–‡ä»¶ï¼Œå­˜å‚¨äºGitHub/gitee

![](https://note.youdao.com/yws/api/personal/file/45E648D842B740DA9DCC6B6EFB3CFA6E?method=download&shareKey=d4ba260cf6a35c89aa9f64f0fb5c2cfd)



## æ­å»ºé…ç½®ä¸­å¿ƒ

> ä¸€ä¸ªå¾®æœåŠ¡ç³»ç»Ÿï¼Œquickstart

### pomæ–‡ä»¶

1. ç»§æ‰¿parent

2. ä¾èµ–start-web

3. å¯¼å…¥spring cloud ä¾èµ–èµ„æº

4. ä¾èµ–config-server

   ```xml
   <dependency>
       <groupId>org.springframework.cloud</groupId>
       <artifactId>spring-cloud-config-server</artifactId>
   </dependency>
   ```

   

### application.properties

```properties
server.port=9999

#è¿æ¥gitä»“åº“çš„urlåœ°å€
spring.cloud.config.server.git.uri=https://github/xxxxx/xxx

#ä»“åº“ä¸­å¯ä»¥ç›´æ¥è®¿é—®é…ç½®æ–‡ä»¶properties/yml
#ä¸€èˆ¬ä½¿ç”¨æ–‡ä»¶å¤¹ç»´æŠ¤ä¸åŒå·¥ç¨‹ä¸åŒåŠŸèƒ½çš„æ–‡ä»¶å¤¹åç§°
spring.cloud.config.server.git.searchPaths=easydv

#å¦‚æœè¯»å–çš„æ˜¯ç§æœ‰æ–‡ä»¶ï¼Œéœ€è¦æä¾›ç™»å½•åå¯†ç 
spring.cloud.config.server.git.username=
spring.cloud.config.server.git.password=
```



### å¯åŠ¨ç±»

```java
@SpringBootApplication
@EnableConfigServer
@EnableEurekaClient
public class StarterConfigServer {
    public static void main(String[] args) {
        SpringApplication.run(StarterConfigServer.class,args);
    }
}
```



### è®¿é—®è¿œç¨‹å…±äº«ä¸­å¿ƒ

> é€šè¿‡è®¿é—®å…±äº«ä¸­å¿ƒçš„ï¼š`application-profile`çš„æ–‡ä»¶åç§°ç»“æ„çš„æ–‡ä»¶ï¼Œè·å–èµ„æºæ•°æ®
>
> - `application`:é…ç½®æ–‡ä»¶æŒ‰åŠŸèƒ½ã€ç§ç±»åˆ‡åˆ†åçš„==åç§°==ï¼Œä¾‹å¦‚ï¼šredisï¼Œdatasourceï¼Œrabbitmqç­‰
> - `profile`:æ¯ä¸€ä¸ªåŠŸèƒ½å’Œç§ç±»çš„é…ç½®æ–‡ä»¶å¯¹åº”çš„æ ‡ç­¾ï¼Œå¯ä»¥è¡¨ç¤ºä¸åŒçš„ä½¿ç”¨ç¯å¢ƒ
>   - redis-ceshi01.properties
>   - redis-ceshi02.properties
>   - redis-shengchan01.properties
> - `lable`ï¼šä½¿ç”¨gitä¸Šçš„å“ªä¸ªåˆ†æ”¯ï¼Œä¸»åˆ†æ”¯ï¼šmasterï¼Œå¯ä»¥ä¸å†™



**åŸºæœ¬è®¿é—®ç»“æ„**ï¼š

`redis.properties`ï¼špropertiesæ˜¯redisï¼Œprofileé»˜è®¤ï¼ˆdefalutï¼‰

`redis-test1.properties`ï¼špropertiesæ˜¯redisï¼Œprofileæ˜¯test1

> urlæ ¼å¼ï¼š
>
> - `http://localhost:9999/redis/test1/master`
> - `http://localhost:9999/master/redis-test1.properties`

**å‘ç°**ï¼šå¦‚æœå…±äº«ä¸­å¿ƒæœ‰ï¼šredis.propertieså’Œredis-test1.propertiesä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœè¯·æ±‚æ˜¯ï¼š`http://localhost:9999/redis/test1/master`.

- ä¼šè¿”å›redis.propertiesé…ç½®æ–‡ä»¶
- è¿”å›redis-test1.propertiesé…ç½®æ–‡ä»¶

**ç»“è®º**ï¼šå…ˆå»æ¯”å¯¹==å®Œæ•´åç§°==ï¼š`redis-test1.properties`ï¼Œå†å»æ¯”å¯¹==åç§°==ï¼š`redis`,å°†æ»¡è¶³`redis`ä½†æ˜¯æ²¡æœ‰`test1`åç§°çš„propertiesä¸€å¹¶è¿”å›ã€‚

> åŸºäºè¿™ä¸€ç‰¹æ€§
>
> - å¯ä»¥åœ¨åªæœ‰åå­—çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€äº›å…¬å…±å±æ€§ï¼šæœ€å¤§è¿æ¥ã€æœ€å°é“¾æ¥ã€æœ€å¤§ç©ºé—²ç­‰
> - åœ¨å®Œæ•´åç§°æ–‡ä»¶ä¸­é…ç½®æ¯ä¸€ä¸ªæœåŠ¡æä¾›è€…ç‰¹æœ‰çš„å±æ€§



**å…¬å…±é…ç½®æ–‡ä»¶**ï¼šå¦‚æœgitè¿œç¨‹å…±äº«ä¸­å¿ƒä¸­æœ‰å«ï¼š`application.properties`çš„æ–‡ä»¶ï¼Œä¼šç›´æ¥è¯»å–ï¼Œæ— è®ºå®¢æˆ·ç«¯(æœåŠ¡æä¾›è€…)è®¿é—®çš„æ˜¯å“ªä¸ªé…ç½®æ–‡ä»¶ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠè¿™ä¸ª`application.properties`ä¸­çš„å†…å®¹å¼ºåˆ¶ä¼ é€’ç»™å®¢æˆ·ç«¯



## æ­å»ºå®¢æˆ·ç«¯

> ä¸€ä¸ªæ­£å¸¸çš„æœåŠ¡æä¾›è€…

### pomæ–‡ä»¶

- ç»§æ‰¿parent

- ä¾èµ–ã€‚ã€‚ã€‚ã€‚

- ä¾èµ–config

  ```xml
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-config</artifactId>
  </dependency>
  ```



### bootstrap.properties

> `bootstrap.propertiesæ–‡ä»¶æ˜¯å…ˆäº`application.properties`åŠ è½½çš„ã€‚
>
> ==`application.properties`æ–‡ä»¶ä¸­å¯åŠ¨webè¿›ç¨‹çš„==

```properties
server.port=9998
spring.application.name=config-client
eureka.client.service-url.defaultZone=http://localhost:8761/eureka

#å½“å‰å·¥ç¨‹ä½œä¸ºå®¢æˆ·ç«¯è¯»å–å…¬ç”¨é…ç½®æ–‡ä»¶
#æŒ‰ç…§éœ€è¦æŒ‡å®šè¯»å–applicationåå­—
spring.cloud.config.name=redis,datasource,mybatis,elastcisearc,rabbitmq
#profile
spring.cloud.config.profile=test1
spring.cloud.config.label=master
#æŒ‡å®šé…ç½®ä¸­å¿ƒconfig-serverè¿æ¥åœ°å€
spring.cloud.config.uri=http://localhost:9999/
```



### å¯åŠ¨ç±»

```java
@SpringBootApplication
@RestController
public class StarterConfigClient {
    //éªŒè¯è¯»å–åˆ°çš„propertieså±æ€§åœ¨æœ¬åœ°å·¥ç¨‹èƒ½å¦æ­£å¸¸ä½¿ç”¨
    @Value("${date}")
    private String date;
    @Value("${name}")
    private String rand;

    @RequestMapping("profile")
    public String profile(){
        return rand;
    }
    //ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†æµ‹è¯•æ•°æ®



    //å¯åŠ¨ç±»ä¸»æ–¹æ³•
    public static void main(String[] args) {
        SpringApplication.run(StarterConfigClient.class,args);
    }
}
```





## é…ç½®ä¸­å¿ƒé›†ç¾¤

> ä¸€ä¸ªé…ç½®ä¸­å¿ƒæ˜¯æ²¡æœ‰é«˜å¯ç”¨æ€§çš„ï¼Œå½“å”¯ä¸€çš„ä¸€ä¸ªé…ç½®ä¸­å¿ƒå®•æœºï¼Œæ•´ä¸ªç³»ç»Ÿå°±æ²¡æœ‰äº†é…ç½®ä¿¡æ¯äº†ã€‚éœ€è¦æ­å»ºä¸€ä¸ª==é…ç½®ä¸­å¿ƒé›†ç¾¤==ï¼Œé€šè¿‡æ³¨å†Œåˆ°eurekaæ³¨å†Œä¸­å¿ƒï¼Œè¢«å…¶ä»–æœåŠ¡æä¾›è€…æŠ“å–åˆ°

![](https://note.youdao.com/yws/api/personal/file/E254B4D5EE9641E586CE8EBAADAFF197?method=download&shareKey=01ac9eb87e41705cbe6e662653b4d912)

### æ·»åŠ eurekaä¾èµ–

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-eureka</artifactId>
</dependency>
```



### é…ç½®ä¸­å¿ƒapplication.properties

```properties
#eurekaé…ç½®
spring.application.name=config-server
server.port=9999
#æ³¨å†Œä¸­å¿ƒåœ°å€
eureka.client.service-url.defaulZone=http://localhost:8761/eureka

#è¿æ¥gitä»“åº“çš„urlåœ°å€
spring.cloud.config.server.git.uri=https://github/xxxxx/xxx

#ä»“åº“ä¸­å¯ä»¥ç›´æ¥è®¿é—®é…ç½®æ–‡ä»¶properties/yml
#ä¸€èˆ¬ä½¿ç”¨æ–‡ä»¶å¤¹ç»´æŠ¤ä¸åŒå·¥ç¨‹ä¸åŒåŠŸèƒ½çš„æ–‡ä»¶å¤¹åç§°
spring.cloud.config.server.git.searchPaths=easydv

#å¦‚æœè¯»å–çš„æ˜¯ç§æœ‰æ–‡ä»¶ï¼Œéœ€è¦æä¾›ç™»å½•åå¯†ç 
spring.cloud.config.server.git.username=
spring.cloud.config.server.git.password=
```



### å®¢æˆ·ç«¯bootstrap.properties

```properties
server.port=9998
spring.application.name=config-client
eureka.client.service-url.defaultZone=http://localhost:8761/eureka

#å½“å‰å·¥ç¨‹ä½œä¸ºå®¢æˆ·ç«¯è¯»å–å…¬ç”¨é…ç½®æ–‡ä»¶
#æŒ‰ç…§éœ€è¦æŒ‡å®šè¯»å–applicationåå­—
spring.cloud.config.name=redis,datasource,mybatis,elastcisearc,rabbitmq
#profile
spring.cloud.config.profile=test1
spring.cloud.config.label=master

#configå®¢æˆ·ç«¯è¦ä»¥æœåŠ¡æŠ“å–çš„æ–¹å¼ï¼Œè·å–config-serveræœåŠ¡
#è´Ÿè½½å‡è¡¡è®¿é—®
spring.cloud.config.discovery.enabled=true
spring.cloud.config.discovery.service-id=config-server
#å‘èµ·è¯·æ±‚http://localhost:9999/redis/test1/master
```





------



# feign

**å’Œribbonçš„å…³ç³»**ï¼šfeignæ˜¯è´Ÿè½½å‡è¡¡è®¿é—®/è°ƒç”¨å¾®æœåŠ¡å®¢æˆ·ç«¯çš„ç»„ä»¶ï¼Œåº•å±‚å°è£…äº†ribbon+RestTemplateï¼Œå¹¶ä¸”åˆ©ç”¨å£°æ˜å¼çš„==æ³¨è§£==æ¥è°ƒç”¨

**ä¸€èˆ¬feignçš„ä½œç”¨æ˜¯**ï¼šåšå…¬ç”¨æœåŠ¡è°ƒç”¨ç»Ÿä¸€çš„å…¥å£ã€‚èƒ½ä½¿ç”¨ribbonçš„åœ°æ–¹ï¼Œéƒ½èƒ½æ›¿æ¢æˆfeignï¼Œåä¹‹äº¦ç„¶ã€‚==ä½¿ç”¨æœ€å¤šçš„æ˜¯feign(ç®€å•)==

**feignä¸ribbonçš„åŒºåˆ«**ï¼šfeignæœ‰ç†”æ–­åŠŸèƒ½ï¼Œribbonæ²¡æœ‰



## feignå®¢æˆ·ç«¯

> åŒæ ·æ˜¯ä¸€ä¸ªSpringCloudå·¥ç¨‹ï¼Œä½œä¸ºä¸€ä¸ªmoduleå­å·¥ç¨‹

### pom

- ç»§æ‰¿çˆ¶å·¥ç¨‹

- å¯¼å…¥SpringCloudä¾èµ–

- ä¾èµ–spring-web

- ä¾èµ–eureka-client

- ä¾èµ–feignç»„ä»¶

  ```xml
  <!--feignç»„ä»¶-->
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-feign</artifactId>
  </dependency>
  ```

  

### application.properties

```properties
#ç«¯å£9001
server.port=9005
server.context-path=/feign
#æä¾›ä¸€ä¸ªè¯¥å·¥ç¨‹æœåŠ¡åç§°ï¼Œä½¿ç”¨æ³¨å†Œåœ¨æ³¨å†Œä¸­å¿ƒ serviceId
spring.application.name=service-feign
#å¼€å¯æ³¨å†Œï¼Œå¼€å¯æŠ“å–çš„åŠŸèƒ½
#å¼€å¯ipåœ°å€ä½¿ç”¨ä¼˜å…ˆ
eureka.instance.prefer-ip-address=true
#æŒ‡å‘æ³¨å†Œä¸­å¿ƒçš„åœ°å€å®ç°æ³¨å†Œå‘ç°
eureka.client.cn.tedu.service-url.defaultZone=http://127.0.0.1:8761/eureka
```



### å¯åŠ¨ç±»

```java
@SpringBootApplication
@EnableEurekaClient
@EnableFeignClients//è¿›ç¨‹å°†ä¼šä»¥feignå®¢æˆ·ç«¯å¯åŠ¨
public class StarterFeign {
    public static void main(String[] args) {
        SpringApplication.run(StarterFeign.class,args);
    }
}
```





## æ³¨è§£çš„ä½¿ç”¨

åœ¨feignå·¥ç¨‹å®ç°æœåŠ¡è°ƒç”¨å…¶ä»–æœåŠ¡æä¾›è€…çš„åŠŸèƒ½ï¼Œé€šè¿‡è®¿é—®feignå·¥ç¨‹ï¼Œå®ç°åç«¯9001/9002çš„è°ƒç”¨

- ç±»æ³¨è§£ï¼š`@FeignClient(è¦è®¿é—®çš„æœåŠ¡æä¾›è€…çš„æœåŠ¡åç§°)`
- æ–¹æ³•æ³¨è§£ï¼š
  - `@RequestMapping`ï¼šå®šä¹‰è®¿é—®åç«¯æœåŠ¡çš„urlæ¥å£å’Œè®¿é—®çš„æ–¹å¼
- æ–¹æ³•å‚æ•°æ³¨è§£ï¼š
  - `@RequestParam`/`@RequestBody`ï¼šå®šä¹‰å‚æ•°æºå¸¦çš„åç§°å’Œæ–¹å¼

```java
/**
 * feignä½œä¸ºè´Ÿè½½å‡è¡¡è°ƒç”¨æœåŠ¡å®¢æˆ·ç«¯
 * å¯ä»¥é€šè¿‡æ³¨è§£å½¢å¼å®ç°åº•å±‚ä»£ç å°è£…
 * ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™httpè¯·æ±‚ä»£ç ä¸ç”¨å†™restTemplate
 * é…åˆSpringmvcçš„æ³¨è§£å®ç°
 */
@FeignClient("service-hi")//è¡¨ç¤ºè¯¥æ¥å£äº¤ç»™feignç»„ä»¶
//å®ç°åº•å±‚é€»è¾‘ï¼Œå¹¶ä¸”è¯¥æ¥å£çš„å®ç°ç±»ä¸­ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦
//è®¿é—®service-hiè¿™ä¸ªæœåŠ¡
public interface HelloService {
    /*
    å³ä½¿ä½¿ç”¨æ³¨è§£å®ç°è®¿é—®æœåŠ¡æŒ‡å®šï¼Œservice-hiï¼Œå¯¹ç€æœåŠ¡åç«¯
    æä¾›è€…ä¸­è¿™å¯èƒ½æœ‰å¥½å‡ ä¸ªè®¿é—®çš„æ¥å£ service-hi/hello
    service-hi/haha service-hi/kaka springmvcæ³¨è§£å®ç°æ›´è¯¦ç»†çš„è¯·æ±‚
    æ–¹æ³•å®šä¹‰
    @RequestMapping å®šä¹‰uri method
    å®ç°æ–¹æ³•ï¼šrestTemplate.getForObject("http://service-hi/client/hello")
    @RequestParam å®šä¹‰è¯·æ±‚å‚æ•°
    å®ç°æ–¹æ³•ï¼šrestTemplate.getForObject("http://service-hi/client/hello?name="+name,String.class)
     */
    @RequestMapping(value="/client/hello",method = RequestMethod.GET)
    String sayHi(@RequestParam("name")String name);
    //è¿™ä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½å’Œè¢«è®¿é—®çš„å·¥ç¨‹ä¸­çš„controlleræ–¹æ³•
    //å®Œå…¨ä¸€è‡´
    /*
    @RequestMapping(value="/client/hello",method = RequestMethod.GET)
    public String sayHello(@RequestParam("name") String name){
     */
}

```



## feignå’Œribbonçš„å¯¹æ¯”

### ribbon

å¯ä»¥åœ¨ä¸šåŠ¡å±‚ä¸­å¯¹äºè°ƒç”¨çš„å‰åé€»è¾‘åšå°è£…ï¼Œhttpè¯·æ±‚å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå¤´å°è£…æ›´è¯¦ç»†

### feign

æœåŠ¡è°ƒç”¨è¿‡ç¨‹åªèƒ½é€šè¿‡æ³¨è§£å®ç°ï¼Œè°ƒç”¨å•ä¸€

==è‡ªåŠ¨æ”¯æŒï¼Œç†”æ–­æœºåˆ¶çš„æ–­è·¯å™¨å’ŒæœåŠ¡é™çº§==

### åº”ç”¨åœºæ™¯

ribbonå“ªéƒ½èƒ½ç”¨ï¼Œä½†æ˜¯ä»£ç å¤æ‚

feign==ä¸€èˆ¬ä½¿ç”¨åœ¨å…¬ç”¨æœåŠ¡çš„è°ƒç”¨å…¥å£çš„ç¼–ç¨‹==ï¼Œfeignçš„ä¸šåŠ¡å±‚ä»£ç ä¸­ä½¿ç”¨çš„æ³¨è§£ï¼Œå‡ ä¹å’Œåç«¯è°ƒç”¨æœåŠ¡çš„æ³¨è§£ç›¸åŒï¼ˆfeignçš„service--->åç«¯controllerï¼‰

![](https://note.youdao.com/yws/api/personal/file/E940B41805D84208A68B0A6CF4258873?method=download&shareKey=47e8db4402dd19998eaac51dd855afad)

![](https://note.youdao.com/yws/api/personal/file/34A66A5D1D964228A8A31AF6B5F27E51?method=download&shareKey=061db74c32112e9934eeb75b961619b0)





------



# hystrix

> ç†”æ–­æœºåˆ¶

å¾®æœåŠ¡é›†ç¾¤ä¸­ï¼Œå­˜åœ¨å¤§é‡çš„åŠŸèƒ½éœ€è¦è°ƒç”¨å…¶ä»–æœåŠ¡ï¼Œå¯¼è‡´è°ƒç”¨é“¾å’Œè°ƒç”¨é€»è¾‘å¯èƒ½ä¼šéå¸¸å¤æ‚ï¼Œç»å¸¸å‡ºç°åŒä¸€ä¸ªæœåŠ¡è¢«ä¸åŒçš„æœåŠ¡è°ƒç”¨

![](https://note.youdao.com/yws/api/personal/file/22B1B1863A624CB1BB9047F9DB1BED95?method=download&shareKey=55d74467e58108513c37d745210efd6f)



> æ²¡æœ‰ç†”æ–­æœºåˆ¶ä¼šå‡ºç°çš„é—®é¢˜

![](https://note.youdao.com/yws/api/personal/file/5FCC9CA7B8794D31A08F3B53D0CB164F?method=download&shareKey=d844b1f2eec7ca321579fcd453b066f7)

> ä¸€ä¸ªæœåŠ¡ä¸­æŸä¸ªæœåŠ¡å®ä¾‹æ•…éšœæˆ–ä¸å¯è¾¾å¯¼è‡´çš„è¯·æ±‚å‹åŠ›ç§¯å‹é—®é¢˜ï¼Œå¼•èµ·ä¸€ä¸ªæœåŠ¡è°ƒç”¨é“¾ç˜«ç—ªã€‚æœªè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å¼•å…¥ç†”æ–­æœºåˆ¶



## ç†”æ–­æœºåˆ¶

å·¥ä½œåŸç†ï¼šç‰ºç‰²å±€éƒ¨ä¿å­˜å…¨å±€ï¼Œé€€è€Œæ±‚å…¶æ¬¡çš„è·å–å“åº”ç»“æœ

### æ–­è·¯å™¨

ç›´æ¥ç‰ºç‰²åç«¯æ•…éšœçš„æœåŠ¡æä¾›è€…ï¼Œä¸å†è®¿é—®è¯¥æœåŠ¡å®ä¾‹

æ–­è·¯å™¨çš„ä¸‰ç§çŠ¶æ€ï¼š

- **æ‰“å¼€**ï¼šæ–­è·¯å™¨ä¸€æ—¦æ‰“å¼€ï¼Œåç«¯æœåŠ¡æä¾›è€…å°±ä¸ä¼šè¢«è®¿é—®ï¼ˆæ¯è¿‡ä¸€æ®µæ—¶é—´ä¼šè¿›å…¥åŠå¼€çŠ¶æ€è¿›è¡Œå°è¯•æ¢å¤è¿æ¥ï¼‰
- **åŠå¼€**ï¼šæ–­è·¯å™¨å°è¯•å°†ä¸€éƒ¨åˆ†è¯·æ±‚å‘é€ç»™æ•…éšœåçš„æœåŠ¡å®ä¾‹
  - å¦‚æœå“åº”æˆåŠŸï¼Œè¯´æ˜æ¢å¤è®¿é—®ï¼Œæ–­è·¯å™¨å…³é—­
  - å¦‚æœå“åº”å¤±è´¥ï¼Œæ–­è·¯å™¨ç»§ç»­æ‰“å¼€
- **å…³é—­**ï¼šå¯ä»¥è®¿é—®åç«¯æœåŠ¡å®ä¾‹

![](https://note.youdao.com/yws/api/personal/file/5E00E3FA65154F14B2843B09C2CD7BF9?method=download&shareKey=9985d73cc4daca617060ad7482c4ff12)



### æœåŠ¡é™çº§

æ–­è·¯å™¨åœ¨ç‰ºç‰²å±€éƒ¨çš„åŸåˆ™ä¸‹ï¼Œæ˜¯å¾—å¤§é‡çš„è®¿é—®ä¸ä¼šé€šè¿‡æ•…éšœå®ä¾‹è¿”å›è¯·æ±‚ã€‚ä½†æ˜¯ä¾ç„¶åæ­£å¸¸çš„æœºå™¨ï¼Œå½“è´Ÿè½½å‡è¡¡å†æ¬¡åˆ†åˆ°æ•…éšœæœåŠ¡å®ä¾‹æ—¶ï¼Œè¯·æ±‚ä¾ç„¶ä¼šè¶…æ—¶ï¼Œé”™è¯¯

è¿™å°±éœ€è¦å¼•å…¥==æœåŠ¡é™çº§==ï¼Œå½“è¯¥æœåŠ¡æ•…éšœåï¼Œåˆ°è¿™é‡Œæ¥çš„è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªé€€è€Œæ±‚å…¶æ¬¡çš„å“åº”

![](https://note.youdao.com/yws/api/personal/file/04C6667BB9CA45819120678F23CF5487?method=download&shareKey=9607bcffaddb7df648a6064fdb6db19f)

> é™çº§æœåŠ¡åšå¾—äº‹æƒ…å¯ä»¥è‡ªå®šä¹‰ï¼Œæ¯”å¦‚ï¼š
>
> - ç»§ç»­åšè´Ÿè½½å‡è¡¡ï¼Œå¯»æ‰¾é›†ç¾¤ä¸­å¯ç”¨çš„æœåŠ¡å®ä¾‹ï¼Œå¦‚æœå¤±è´¥ï¼Œå¯ä»¥å†æ¬¡é™çº§ï¼Œç»§ç»­å¯»æ‰¾ã€‚æœ€åæ‰¾ä¸åˆ°æŠ¥é”™
> - ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›å“åº”ï¼šæœåŠ¡å™¨ç¹å¿™ç­‰ä¹‹ç±»çš„æ¶ˆæ¯



## åŸºäºribbonåŠŸèƒ½æ·»åŠ ç†”æ–­æœºåˆ¶

### pom

æ·»åŠ hystrixçš„ä¾èµ–

```xml
<!--hystrix ç†”æ–­-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-hystrix</artifactId>
</dependency>
```



### å¯åŠ¨ç±»

å¯åŠ¨ç±»ä¸­è¦æ·»åŠ æ–­è·¯å™¨æ³¨è§£ï¼Œå¼€å¯ç†”æ–­æœºåˆ¶

```java
@EnableCircuitBreaker//å¼€å¯ç†”æ–­æœºåˆ¶
public class Starterxxx{
    public static void main(String[] args){
        SpringApplication.run(Starterxxx.class,args);
    }
}
```



### serviceç±»

> åœ¨serviceæ–¹æ³•ä¸Šæ·»åŠ æœåŠ¡é™çº§çš„æ³¨è§£

```java
/*
 * é€šè¿‡ä½¿ç”¨ç†”æ–­æœºåˆ¶çš„æ³¨è§£HystrixCommand
 * å®šä¹‰å½“å‰è°ƒç”¨æ–¹æ³•å¤±è´¥ï¼ˆåç«¯è¶…æ—¶ï¼Œè¿æ¥å¤±è´¥ï¼‰
 * åçš„é™çº§é€»è¾‘ fallbackMethodçš„å€¼ï¼Œå°±æ˜¯å½“å‰ç±»ä¸­ä¸€ä¸ªæ–¹æ³•åç§°
 */

@HystrixCommand(fallbackMethod="error")
public String sayHi(String name) {
    //http://service-hi/hello?name=wang
    String sayHi=client.getForObject("http://service-hi/hello?name="+name,String.class);
    return sayHi;
}

//è¦ä¿è¯å’Œæ­£å¸¸è°ƒç”¨æ–¹æ³•sayHiçš„å‚æ•°ç»“æ„ä¸€è‡´ï¼Œè¿”å›ç»“æ„ä¸€è‡´
@HystrixCommand(fallbackMethod="sayHi")
public String error(String name){
    //http://service-hi/hello?name=wang
    String sayHi=client.getForObject("http://service-hi/hello?name="+name,String.class);
    return sayHi;
}
```







# å…¶ä»–ç»„ä»¶

- sleuthï¼šæµè·Ÿè¸ª
- busï¼šæ¶ˆæ¯æ€»çº¿
- security ï¼šå®‰å…¨æ¡†æ¶
- security+OAth2ï¼šæˆæƒ
- .......



# é¢è¯•é¢˜

> å¾®æœåŠ¡é›†ç¾¤ä¸­å¦‚æœç™»å½•é›†ç¾¤çš„èŠ‚ç‚¹å…¨éƒ¨å®•æœºï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ

æ€è·¯ï¼š

- ç†”æ–­æœºåˆ¶æè¿°
- æ–­è·¯å™¨
- æœåŠ¡é™çº§

å½“æ‰€æœ‰èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œå¯ä»¥é€šè¿‡`@HystrixCommand`æ³¨è§£å®ç°è‡ªå®šä¹‰çš„æœåŠ¡é™çº§é€»è¾‘ï¼Œè¿˜å¯ä»¥è¿›è¡Œå¤šçº§é™çº§é€»è¾‘

è¿˜å¯ä»¥å®ç°ä¸€ä¸ªå¾®æœåŠ¡é›†ç¾¤ä¸­çš„æœåŠ¡å…¨éƒ¨å®•æœºåï¼Œå¯åŠ¨åå¤‡çš„æœåŠ¡ï¼Œæ—¶æœåŠ¡é™çº§åˆ°å¤‡ç”¨æœåŠ¡ä½¿ç”¨ï¼ˆè§£å†³æç«¯ç°è±¡çš„åŠæ³•ï¼‰